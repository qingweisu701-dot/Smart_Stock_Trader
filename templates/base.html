{% load static %}
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>æ™ºèƒ½é‡åŒ–æŠ•ç ”å¹³å°</title>
    <link rel="stylesheet" href="{% static 'css/element-plus.css' %}">
    <script src="{% static 'js/vue.global.js' %}"></script>
    <script src="{% static 'js/element-plus.js' %}"></script>
    <script src="{% static 'js/element-plus-icons.js' %}"></script>
    <script src="{% static 'js/echarts.min.js' %}"></script>
    <script src="{% static 'js/axios.min.js' %}"></script>
    <style>
        body { margin: 0; background: #f5f7fa; font-family: 'PingFang SC', sans-serif; }
        .el-aside { background: #001529; color: white; height: 100vh; transition: width 0.3s; }
        .logo { height: 60px; line-height: 60px; text-align: center; font-size: 18px; font-weight: bold; background: #002140; color: #409EFF; cursor: pointer; border-bottom: 1px solid #000; }
        .header { background: #fff; height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.05); }
        .el-menu { border-right: none; }
        [v-cloak] { display: none; }
        .el-breadcrumb { font-size: 14px; line-height: 60px; }
    </style>
</head>
<body>
    <div id="app" v-cloak>
        <el-container>
            <el-aside width="220px">
                <div class="logo" @click="go('/api/dashboard/')">ğŸ“ˆ Smart Trader</div>

                <el-menu background-color="#001529" text-color="#fff" active-text-color="#409EFF"
                         :default-active="activeMenu" :default-openeds="['1', '2', '3']">

                    <el-menu-item index="0" @click="go('/api/dashboard/')">
                        <el-icon><Odometer /></el-icon><span>é©¾é©¶èˆ± (Dashboard)</span>
                    </el-menu-item>

                    <el-sub-menu index="1">
                        <template #title><el-icon><Edit /></el-icon><span>å›¾å½¢ç®¡ç†å®éªŒå®¤</span></template>
                        <el-menu-item index="1-1" @click="go('/api/pattern/lab/')">ğŸ“ ç»˜åˆ¶ä¸å½¢æ€åº“</el-menu-item>
                    </el-sub-menu>

                    <el-sub-menu index="2">
                        <template #title><el-icon><Search /></el-icon><span>å¸‚åœºåˆ†æä¸æ‰«æ</span></template>
                        <el-menu-item index="2-1" @click="go('/api/analysis/scan/')">ğŸ” æ™ºèƒ½ç­›é€‰å™¨</el-menu-item>
                        <el-menu-item index="2-2" @click="go('/api/analysis/fav/')">â­ æˆ‘çš„è§‚å¯Ÿä»“</el-menu-item>
                    </el-sub-menu>

                    <el-sub-menu index="3">
                        <template #title><el-icon><Cpu /></el-icon><span>é‡åŒ–å†³ç­–ä¸­å¿ƒ</span></template>
                        <el-menu-item index="3-1" @click="go('/api/decision/center/')">ğŸ“Š æ·±åº¦åˆ†æä¸å›æµ‹</el-menu-item>
                    </el-sub-menu>

                    <el-menu-item index="4" @click="go('/api/trade/history/')">
                        <el-icon><List /></el-icon><span>äº¤æ˜“æµæ°´</span>
                    </el-menu-item>
                </el-menu>
            </el-aside>
            <el-container>
                <el-header class="header">
                    <el-breadcrumb separator="/">
                        <el-breadcrumb-item :to="{ path: '/api/dashboard/' }">é¦–é¡µ</el-breadcrumb-item>
                        <el-breadcrumb-item>[[ pageTitle ]]</el-breadcrumb-item>
                    </el-breadcrumb>
                    <div @click="showMsg" style="cursor: pointer;">
                        <el-icon size="20"><Bell /></el-icon>
                    </div>
                </el-header>
                <el-main>
                    {% block content %}{% endblock %}
                </el-main>
            </el-container>
        </el-container>
    </div>

    {% block scripts %}{% endblock %}

    <script>
        const { createApp, ref, onMounted, computed, watch } = Vue;
        if (typeof pageSetup === 'undefined') { window.pageSetup = () => ({}); }

        const app = createApp({
            delimiters: ['[[', ']]'],
            setup() {
                const path = window.location.pathname;
                let m = '0';
                let title = 'é©¾é©¶èˆ±';

                // è‡ªåŠ¨æ›´æ–°é¢åŒ…å±‘æ ‡é¢˜
                if(path.includes('pattern')) { m='1-1'; title='å›¾å½¢ç®¡ç†å®éªŒå®¤'; }
                else if(path.includes('analysis/scan')) { m='2-1'; title='æ™ºèƒ½ç­›é€‰å™¨'; }
                else if(path.includes('analysis/fav')) { m='2-2'; title='æˆ‘çš„è§‚å¯Ÿä»“'; }
                else if(path.includes('decision')) { m='3-1'; title='å†³ç­–ä¸­å¿ƒ'; }
                else if(path.includes('trade')) { m='4'; title='äº¤æ˜“æµæ°´'; }

                const activeMenu = ref(m);
                const pageTitle = ref(title);
                const go = (url) => window.location.href = url;
                const showMsg = () => ElementPlus.ElMessage.info('æš‚æ— æ–°æ¶ˆæ¯');

                const pageLogic = window.pageSetup();
                return { activeMenu, pageTitle, go, showMsg, ...pageLogic };
            }
        });
        app.use(ElementPlus);
        for (const [key, component] of Object.entries(ElementPlusIconsVue)) { app.component(key, component) }
        app.mount('#app');
    </script>
</body>
</html>