{% extends 'base.html' %}
{% block title %}å¸‚åœºå…¨æ™¯é©¾é©¶èˆ±{% endblock %}

{% block content %}
<el-row :gutter="20">
    <el-col :span="6">
        <el-card shadow="hover" class="data-card">
            <div class="card-title">ğŸ“ˆ ä¸Šè¯æŒ‡æ•°</div>
            <div class="card-num" style="color:#F56C6C">3,285.42 <small>+0.5%</small></div>
            <div class="card-desc">æ”¾é‡ä¸Šæ¶¨ï¼Œè¶‹åŠ¿å‘å¥½</div>
        </el-card>
    </el-col>
    <el-col :span="6">
        <el-card shadow="hover" class="data-card">
            <div class="card-title">ğŸ”¥ å¸‚åœºçƒ­åº¦</div>
            <div class="card-num">[[ market.up_count ]] å®¶ä¸Šæ¶¨</div>
            <el-progress :percentage="70" color="#F56C6C" :show-text="false"></el-progress>
            <div class="card-desc">ä¸‹è·Œ [[ market.down_count ]] å®¶ï¼Œå¤šå¤´å ä¼˜</div>
        </el-card>
    </el-col>
    <el-col :span="6">
        <el-card shadow="hover" class="data-card">
            <div class="card-title">ğŸ’° ä¸¤å¸‚æˆäº¤</div>
            <div class="card-num">[[ market.volume ]]</div>
            <div class="card-desc">è¾ƒæ˜¨æ—¥ç¼©é‡ 500äº¿</div>
        </el-card>
    </el-col>
    <el-col :span="6">
        <el-card shadow="hover" class="data-card" style="background:#ecf5ff; cursor:pointer" @click="go('/api/pattern/lab/')">
            <div class="card-title" style="color:#409EFF">ğŸ¨ å¿«é€Ÿåˆ›ä½œ</div>
            <div class="card-num" style="font-size:20px; margin-top:10px">ç»˜åˆ¶æ–°ç­–ç•¥</div>
            <div class="card-desc">ç‚¹å‡»è¿›å…¥å›¾å½¢å®éªŒå®¤</div>
        </el-card>
    </el-col>
</el-row>

<el-row :gutter="20" style="margin-top:20px">
    <el-col :span="16">
        <el-card header="ğŸ“Š å¸‚åœºæ ¸å¿ƒè¶‹åŠ¿ (ä»¥ä¸Šè¯ä¸ºä¾‹)">
            <div id="index-chart" style="height:400px"></div>
        </el-card>
    </el-col>

    <el-col :span="8">
        <el-card header="ğŸš€ ç­–ç•¥ä¿¡å·é¢„è­¦" style="height:460px">
            <div style="margin-bottom:15px; color:#666; font-size:12px">ä»Šæ—¥è§¦å‘æ‚¨æ”¶è—å½¢æ€çš„ä¸ªè‚¡ï¼š</div>
            <div class="signal-list">
                <div class="signal-item" @click="go('/api/stock/detail/?code=600519.SH')">
                    <el-tag size="small" type="danger">äº”æµªä¸Šæ¶¨</el-tag>
                    <span style="font-weight:bold; margin-left:10px">è´µå·èŒ…å°</span>
                    <span style="float:right; color:#F56C6C">+2.1%</span>
                </div>
                <div class="signal-item">
                    <el-tag size="small" type="success">å¤´è‚©é¡¶</el-tag>
                    <span style="font-weight:bold; margin-left:10px">å®å¾·æ—¶ä»£</span>
                    <span style="float:right; color:#67C23A">-1.5%</span>
                </div>
                <div class="signal-item">
                    <el-tag size="small" type="warning">MACDé‡‘å‰</el-tag>
                    <span style="font-weight:bold; margin-left:10px">æ‹›å•†é“¶è¡Œ</span>
                    <span style="float:right; color:#F56C6C">+0.8%</span>
                </div>
            </div>

            <div style="margin-top:30px; text-align:center">
                <el-button type="primary" plain style="width:100%" @click="go('/api/analysis/scan/')">è¿›å…¥å…¨å¸‚åœºæ‰«æ</el-button>
                <el-button type="success" plain style="width:100%; margin-top:10px; margin-left:0" @click="go('/api/decision/center/')">æŸ¥çœ‹æˆ‘çš„è§‚å¯Ÿä»“</el-button>
            </div>
        </el-card>
    </el-col>
</el-row>
{% endblock %}

{% block scripts %}
<style>
    .data-card { height: 120px; display: flex; flex-direction: column; justify-content: center; }
    .card-title { font-size: 14px; color: #909399; margin-bottom: 5px; }
    .card-num { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
    .card-desc { font-size: 12px; color: #C0C4CC; }
    .signal-item { padding: 12px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: 0.2s; }
    .signal-item:hover { background: #f9f9f9; }
</style>
<script>
function pageSetup() {
    const market = ref({up_count:0, down_count:0, volume:'--', hot_sector:'--'});

    const init = async () => {
        const res = await axios.get('/api/dashboard/data/');
        market.value = res.data.data.market;
        renderChart(res.data.data.index_chart);
    };

    const renderChart = (data) => {
        const chart = echarts.init(document.getElementById('index-chart'));
        chart.setOption({
            tooltip: {trigger:'axis'},
            grid: {top:20, bottom:30, left:40, right:20},
            xAxis: {data: data.map(i=>i.trade_date)},
            yAxis: {scale:true},
            series: [{type:'line', data: data.map(i=>i.close_price), smooth:true, areaStyle:{opacity:0.1}, itemStyle:{color:'#409EFF'}}]
        });
    };

    onMounted(init);
    return { market };
}
</script>
{% endblock %}